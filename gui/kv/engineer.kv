# kv/engineer.kv
#:import sys sys
#:import MapSource kivy_garden.mapview.MapSource

# ScreenManager:
# 	EngineerScreen:
# 		name: 'engineer'
# 	PayScreen:
# 		name: 'pay'

<EngineerScreen@Screen>:
	name: 'engineer'
	MDFloatLayout:
		# orientation: 'vertical'
		
			
		# MDBoxLayout:
		# 	orientation: 'horizontal'
		# 	pos_hint: {'center_x': .5, 'center_y': .93}
		# 	padding: '10dp'
		# 	md_bg_color: app.theme_cls.primary_color
		# 	size_hint: None, None
		# 	size: Window.width, '56dp'
			
		# 	MDLabel:
		# 		text: 'Hi John'
		# 		halign: 'left'
		# 		font_style: 'H4'
		# 		theme_text_color: 'Primary'
		# 		# size_hint_y: None
		# 		# height: self.texture_size[1]

		# 	Image:
		# 		source: 'cache/26a7511794_0_0_0.png'
		# 		size_hint: None, None
		# 		size: '56dp', '56dp'
		# 		pos_hint: {'center_x': .5, 'center_y': .5}
		# 		allow_stretch: True
		# 		keep_ratio: False
				# canvas.after:
				# 	Color:
				# 		rgba: app.theme_cls.primary_color
				# 	Rectangle:
				# 		size: self.size * 0.9
				# 		pos: self.pos
				# 		# source: 'atlas://data/images/defaulttheme/avatar'
		MDBottomNavigation:
			id: nav
		
			# Add a NavigationItem for each Navigation.
			MDBottomNavigationItem:
				name: "home_tab"
				text: "Home"
				icon: "home"
		
				# Add Contents here

				MDTopAppBar:
					title: 'Hi John'
					anchor_title: 'left'
					align: 'left'
					right_action_items: [['emoticon-wink-outline', lambda x: nav.switch_tab('services_tab')]]
					pos_hint: {'top': 1, 'center_x': .5}
				
				MDBoxLayout:
					orientation: 'vertical'
					size_hint: None, None
					size: Window.width, '56dp'
					spacing: '20dp'
					pos_hint: {'center_x': .5, 'center_y': .78}
					MDLabel:
						text: app.totalearnings
						halign: 'center'
						font_style: 'H2'
						bold: True
						theme_text_color: 'Primary'
					MDLabel:
						text: 'Total Earnings in INR'
						halign: 'center'
						theme_text_color: 'Primary'


				MDCard:
					id: jobinfocard
					orientation: 'vertical'
					size_hint: None, None
					size: Window.width*0.9, '250dp'
					pos_hint: {'center_x': .5, 'center_y': .5}
					padding: '10dp'
					spacing: '10dp'
					md_bg_color: app.theme_cls.primary_color
					radius: [20, 20, 20, 20]
					MDBoxLayout:
						orientation: 'vertical'
						MDBoxLayout:
							orientation: 'horizontal'
							# md_bg_color: 0,1,0,1

							MDLabel:
								text: 'Current Job Details'
								halign: 'left'
								theme_text_color: 'Primary'
								font_style: 'H6'
								# size_hint_y: None
								# height: self.texture_size[1]
								# md_bg_color: 1,0,0,1
							MDIconButton:
								icon: 'close'
								theme_text_color: 'Primary'
								# md_bg_color: 1,0,0,1
								pos_hint: {'center_y': .5}
								on_release: app.root.current = 'engineer'
						MDLabel:
							text: 'Address'
							halign: 'left'
							font_style: 'Subtitle1'
							# bold: True
							theme_text_color: 'Secondary'
							# md_bg_color: 1,0,0,1
							size_hint_y: None
							height: self.texture_size[1]
						MDLabel:
							id : job_address
							text: '123 Oak Street, Downtown, NY 10001'
							halign: 'left'
							theme_text_color: 'Secondary'
							font_style: 'H6'
							size_hint_y: None
							height: self.texture_size[1]
						MDLabel:
							text: 'Customer'
							halign: 'left'
							font_style: 'Subtitle1'
							# bold: True
							theme_text_color: 'Secondary'
							# md_bg_color: 1,0,0,1
							size_hint_y: None
							height: self.texture_size[1]
						MDLabel:
							id: job_customer
							text: 'Sarah Wilson'
							halign: 'left'
							font_style: 'Subtitle1'
							bold: True
							theme_text_color: 'Secondary'
							# md_bg_color: 1,0,0,1
							size_hint_y: None
							height: self.texture_size[1]
						MDLabel:
							text: 'Service Type'
							halign: 'left'
							font_style: 'Subtitle1'
							# bold: True
							theme_text_color: 'Secondary'
							# md_bg_color: 1,0,0,1
							size_hint_y: None
							height: self.texture_size[1]
						MDLabel:
							id: job_service
							text: 'AC Maintenance & Repair'
							halign: 'left'
							font_style: 'Subtitle1'
							bold: True
							theme_text_color: 'Secondary'
							# md_bg_color: 1,0,0,1
							size_hint_y: None
							height: self.texture_size[1]
						MDLabel:
							text: 'Scheduled Time'
							halign: 'left'
							font_style: 'Subtitle1'
							# bold: True
							theme_text_color: 'Secondary'
							# md_bg_color: 1,0,0,1
							size_hint_y: None
							height: self.texture_size[1]
						MDLabel:
							id: job_time
							text: 'Today, 2:30 PM - 4:30 PM'
							halign: 'left'
							font_style: 'Subtitle1'
							bold: True
							theme_text_color: 'Secondary'	
							# md_bg_color: 1,0,0,1
							size_hint_y: None
							height: self.texture_size[1]
				MDBoxLayout:
					orientation: 'vertical'
					pos_hint: {'center_x': .5 , 'center_y': .1}
					size_hint_y: None
					height: '300dp'
					MapView:
						lat: app.mapsource[0]
						lon: app.mapsource[1]
						zoom: 13
						map_source: MapSource(sys.argv[1], attribution="") if len(sys.argv) > 1 else "osm"

						MapMarkerPopup:
							lat: app.mapsource[0]
							lon: app.mapsource[1]
							popup_size: dp(230), dp(130)

							Bubble:
								BoxLayout:
									orientation: "horizontal"
									padding: "5dp"
									AsyncImage:
										source: "http://upload.wikimedia.org/wikipedia/commons/9/9d/France-Lille-VieilleBourse-FacadeGrandPlace.jpg"
										mipmap: True
									Label:
										text: "[b]Lille[/b]\\n1 154 861 hab\\n5 759 hab./km2"
										markup: True
										halign: "center"


			MDBottomNavigationItem:
				name: 'services_tab'
				text: 'complaints'
				icon: 'clipboard-list-outline'

				BoxLayout:
                    orientation: 'vertical'
                    
                    CustomRecycleView:
						id: recycle_view
                        do_scroll_x: False
                        


<CustomTwoLineAvatarIconListItem>:
    text: root.text
    secondary_text: root.secondary_text
	# tertiary_text: root.tertiary_text
	# _no_ripple_effect: True
	on_release: app.update()
    IconLeftWidget:
        icon: root.icon_left
    IconRightWidget:
        icon: root.icon_right
        on_release: app.update()

<CustomRecycleView>:
    id: recycle_view
    viewclass: 'CustomTwoLineAvatarIconListItem'
    RecycleBoxLayout:
        default_size: None, None
        default_size_hint: 1, None
        size_hint_y: None
        height: self.minimum_height
        orientation: 'vertical'
        spacing: dp(10)
        padding: dp(10)

<PayScreen@Screen>:
	name: 'pay'

	MDFloatLayout:

		MDTopAppBar:
			title: 'Payment'
			# anchor_title: 'left'
			align: 'left'
			right_action_items: [['refresh', lambda x: print('refresh')]]
			left_action_items: [['arrow-left', lambda x: setattr(app.root,'current' ,'engineer')]]
			pos_hint: {'top': 1, 'center_x': .5}

		
		AsyncImage:
			source: 'https://www.techdatasolution.co.in/images/QR-Code-techdata.jpg'
			size_hint: None, None
			size: Window.width*0.9 , Window.height*0.7
			pos_hint: {'center_x': .5, 'center_y': .5}
			allow_stretch: True
			keep_ratio: False
			# canvas.after:
			# 	Color:
			# 		rgba: app.theme_cls.primary_color
			# 	Rectangle:
			# 		size: self.size * 0.9
			# 		pos: self.pos
			# 		# source: 'atlas://data/images/defaulttheme/avatar'