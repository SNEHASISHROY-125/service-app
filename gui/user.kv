#:kivy 2.1.0

MDScreenManager:
    WelcomeScreen:
    LoginScreen:
    SignupScreen:
    MenuScreen:
    BookApointmentScreen:
    VerifyOTPScreen:

<Item>

    ImageLeftWidget:
        source: root.source

<TwoLineAvatarIconListItem>
    complaint_id: root.complaint_id

<MenuScreen@Screen>:
    name: "services"

    BoxLayout:
        orientation: "vertical"
        MDTopAppBar:
            id: top_app_bar
            title: "All Services"
            pos_hint: {"top": 1.0}
            right_action_items: [["face-man-shimmer", lambda x: print(app.user_name)]]

        MDBottomNavigation:
            id: bottom_nav
            on_switch_tabs: app.on_tab_switch(*args)

            MDBottomNavigationItem:
                name: 'services_tab'
                text: "services"
                icon: "home"
                badge_icon: ""
                icon_color: app.theme_cls.primary_color
                
                BoxLayout:
                    orientation: 'vertical'
                    padding: dp(10)

            
                    MDBoxLayout:
                        orientation: 'vertical'
                        padding: dp(10)
                        spacing: dp(10)
                        
                        md_bg_color: 0.9, 0.7, 0.9, 1
                        radius: [15, 15, 15, 15]
                    
                        MDBoxLayout:
                            orientation: 'horizontal'
                            
                            spacing: dp(10)
                    
                            MDSmartTile:
                                radius: 24
                                box_radius: [0, 0, 24, 24]
                                box_color: 1, 1, 1, .7
                                source: "https://static9.depositphotos.com/1518767/1119/i/450/depositphotos_11193992-stock-photo-smiling-assistant-using-a-headset.jpg"
                                pos_hint: {"center_x": .5, "center_y": .5}
                                on_release: setattr(app.root ,'current' ,'book_apointment') if app.user_id else (app.toast("Please login to book an appointment"), setattr(app.root, 'current', 'login'))
                                
                                MDLabel:
                                    text: "IT Service"
                                    halign: 'center'
                                    bold: True
                                    theme_text_color: "Custom"
                                    text_color: 1, 0.7, 0.3, 1
                                    font_style: "H5"
                                
                            MDSmartTile:
                                radius: 24
                                box_radius: [0, 0, 24, 24]
                                box_color: 1, 1, 1, .7
                                source: "https://thumbs.dreamstime.com/b/electronics-repair-service-hands-senior-tech-reparing-electronic-circuit-43452823.jpg"
                                pos_hint: {"center_x": .5, "center_y": .5}
                                on_release: setattr(app.root ,'current' ,'book_apointment') if app.user_id else (app.toast("Please login to book an appointment"), setattr(app.root, 'current', 'login'))

                                MDLabel:
                                    text: "Electronics Repair Service"
                                    halign: 'center'
                                    bold: True
                                    theme_text_color: "Custom"
                                    text_color: 1, 0.7, 0.3, 1
                                    font_style: "H5"
                        
                        
                        MDBoxLayout:
                            orientation: 'horizontal'
                            
                            spacing: dp(10)
                    
                            MDSmartTile:
                                radius: 24
                                box_radius: [0, 0, 24, 24]
                                box_color: 1, 1, 1, .3
                                source: "https://t3.ftcdn.net/jpg/02/77/69/26/360_F_277692690_xAGq27kZEjCmDq8D3lcttSjM6IeUVgKI.jpg"
                                pos_hint: {"center_x": .5, "center_y": .5}
                                on_release: app.toast("Coming Soon")
                                
                                MDLabel:
                                    text: "Plumbing Service"
                                    halign: 'center'
                                    bold: True
                                    theme_text_color: "Custom"
                                    text_color: 1, 0.7, 0.3, 1
                                    font_style: "H5"
                            MDSmartTile:
                                radius: 24
                                box_radius: [0, 0, 24, 24]
                                box_color: 1, 1, 1, .3
                                source: "https://t3.ftcdn.net/jpg/02/77/69/26/360_F_277692690_xAGq27kZEjCmDq8D3lcttSjM6IeUVgKI.jpg"
                                pos_hint: {"center_x": .5, "center_y": .5}
                                on_release: app.toast("Coming Soon")
                                
                                MDLabel:
                                    text: "Electrical Service"
                                    halign: 'center'
                                    bold: True
                                    theme_text_color: "Custom"
                                    text_color: 1, 0.7, 0.3, 1
                                    font_style: "H5"
                

            MDBottomNavigationItem:
                name: 'appointments_tab'
                text: 'Appointments'
                icon: "new-box"
                badge_icon: "numeric-2"
                icon_color: app.theme_cls.primary_color

                BoxLayout:
                    orientation: 'vertical'
                    
                    ScrollView:
                        do_scroll_x: False
                        MDList:
                            id: appointments_list

                            TwoLineAvatarIconListItem:
                                text: "Your Appointments here"
                                secondary_text: "You have no appointments yet"

                                IconLeftWidget:
                                    icon: "emoticon-wink-outline"

                                IconRightWidget:
                                    icon: "chevron-right"
                            
                            
<BookApointmentScreen@MDScreen>:
    name: 'book_apointment'
    BoxLayout:
        orientation: 'vertical'
        spacing: dp(20)

        MDTopAppBar:
            pos_hint: {'top': 1}
            title: "Book Apointment"
            left_action_items: [["arrow-left", lambda x: setattr(app.root, 'current', 'services')]]

        
        MDBoxLayout:
            
            padding: dp(20)
            md_bg_color: 0.9, 0.7, 0.9, 1
            radius: [30, 30, 15, 15]
            orientation: 'vertical'
                                   
            ScrollView:
                do_scroll_x: False
                MDList:
                    spacing: dp(20)
                    
                    MDTextField:
                        id: issue_desc
                        hint_text: "Tell us a little about your issue"
                        multiline: True
                        max_text_length: 250
                        mode: "rectangle"
                        helper_text: "we need to know what you are facing"
                        helper_text_mode: "on_error"
                        size_hint_y: None
                        height: dp(150)
                        
                    MDTextField:
                        id: user_location
                        hint_text: "Your home Location/Address"
                        max_text_length: 50
                        mode: "rectangle"
                        helper_text: "we need to know where you are"
                        helper_text_mode: "on_focus"

                    MDTextField:
                        id: user_phone
                        hint_text: "Your phone number"
                        max_text_length: 10
                        mode: "rectangle"
                        helper_text: "our team will contact you"
                        helper_text_mode: "on_focus"
                        min_text_length: 10
                        input_filter: "int"
                    MDLabel:
                        text: ""
                        halign: 'center'
                    MDLabel:
                        text: ""
                        halign: 'center'
                    MDLabel:
                        text: ""
                        halign: 'center'
                
                    MDBoxLayout:
                        orientation: 'horizontal'
                        padding: dp(10)
                        spacing: dp(10)
                        MDLabel:
                            text: ""
                            halign: 'center'
                        MDRaisedButton:
                            text: "Book Apointment"
                            on_release: app.book_appointment({"issue_desc": issue_desc.text, "user_location": user_location.text, "user_phone": user_phone.text}) if issue_desc.text and user_location.text and len(user_phone.text)==10 else app.toast("Please fill all fields")
                        
                        


<WelcomeScreen@Screen>:
    name: 'welcome'
    FitImage:
        source: app.image_list[0]
    MDIconButton:
        icon: "skip-next-circle"
        text: "Home"
        icon_size: "32sp"  
        size_hint: None, None
        size: dp(400), dp(80)
        pos_hint: {'top': 1, 'center_x': 0.7}
        on_release: app.root.current = 'services'
    MDLabel:
        text: "Welcome to the Welcome Page!"
        halign: 'center'
        pos_hint: {'center_x': 0.5, 'center_y': 0.5}
    MDRaisedButton:
        text: "Go to Signup"
        pos_hint: {'center_x': 0.5, 'center_y': 0.4}
        on_release: app.root.current = 'signup'

<LoginScreen@Screen>:
    name: 'login'
    
    FitImage:
        source: app.image_list[0]

    MDFloatLayout:
        pos_hint: {'center_x': 0.5, 'center_y': 0.5}
        MDTextField:
            id: email
            hint_text: "Email"
            pos_hint: {'center_x': 0.5, 'center_y': 0.5}
            size_hint_x: None
            max_text_length: 50
            width: 300
        MDRaisedButton: 
            text: "Login"
            pos_hint: {'center_x': 0.5, 'center_y': 0.4}
            on_release: app.login() if email.text and len(email.text)<50 else app.toast("Please enter email")

<VerifyOTPScreen@Screen>:
    name: 'verify_otp'

    FitImage:
        source: app.image_list[0]
        
    MDFloatLayout:
        pos_hint: {'center_x': 0.5, 'center_y': 0.5}
        spacing: dp(10)

        MDTextField:
            id: otp
            hint_text: "ENTER OTP SENT TO YOUR EMAIL"
            pos_hint: {'center_x': 0.5, 'center_y': 0.5}
            size_hint_x: None
            width: 300
            max_text_length: 6
            input_filter: "int"
        MDLabel:
            text: "OTP will expire in 3 minutes"
            halign: 'center'
            pos_hint: {'center_x': 0.5, 'center_y': 0.4}
        MDRaisedButton:
            text: "Verify OTP"
            pos_hint: {'center_x': 0.5, 'center_y': 0.3}
            on_release: app.verify_otp() if otp.text and len(otp.text)==6 else app.toast("Please enter 6 digit OTP")

<SignupScreen@Screen>:
    name: 'signup'

    FitImage:
        source: app.image_list[0]
    MDBoxLayout:
        orientation: 'vertical'
        spacing: dp(10)
        MDTopAppBar: 
            id: top_app_bar
            title: "Signup"
            left_action_items: [["arrow-left", lambda x: setattr(app.root, 'current', "services")]]
            elevation: 10
            
        MDFloatLayout:
            pos_hint: {'center_x': 0.5, 'center_y': 0.8}

            MDTextField:
                id: username
                hint_text: "Username"
                pos_hint: {'center_x': 0.5, 'center_y': 0.6}
                size_hint_x: None
                width: 300
                max_text_length: 20
            MDTextField:
                id: email
                hint_text: "Email"
                pos_hint: {'center_x': 0.5, 'center_y': 0.5}
                size_hint_x: None
                width: 300
                max_text_length: 50
            MDRaisedButton:
                text: "Signup"
                pos_hint: {'center_x': 0.5, 'center_y': 0.4}
                on_release: app.signup() if username.text and email.text and len(email.text)<50 and len(username.text)<20 else app.toast("Please fill all fields")
           